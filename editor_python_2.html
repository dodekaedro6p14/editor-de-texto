<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python Web Editor Pro</title>
    
    <link rel="stylesheet" href="https://pyscript.net/releases/2024.1.1/core.css">
    <script type="module" src="https://pyscript.net/releases/2024.1.1/core.js"></script>

    <style>
        :root { --bg: #1e1e1e; --fg: #d4d4d4; --accent: #007acc; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #252526; color: white; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        
        /* Toolbar */
        .toolbar { background: #333; padding: 10px; display: flex; gap: 10px; border-bottom: 1px solid #444; }
        select, button { background: #444; color: white; border: 1px solid #555; padding: 5px 15px; cursor: pointer; border-radius: 3px; }
        button:hover { background: var(--accent); }

        /* Contenedor del Editor */
        #editor-container { flex-grow: 1; position: relative; overflow: hidden; }
        #code-editor {
            width: 100%; height: 100%;
            background: var(--bg); color: var(--fg);
            border: none; padding: 20px;
            font-family: 'Fira Code', 'Courier New', monospace;
            font-size: 16px; line-height: 1.5;
            resize: none; outline: none;
            tab-size: 4; -moz-tab-size: 4;
        }
        .status-bar { background: var(--accent); font-size: 12px; padding: 3px 10px; display: flex; justify-content: space-between; }
    </style>
</head>
<body>

    <div class="toolbar">
        <input type="text" id="filename" placeholder="nombre-del-archivo" style="background: #222; color: white; border: 1px solid #444; padding: 5px;">
        <select id="format-select">
            <option value="txt">.txt (Texto)</option>
            <option value="py">.py (Python)</option>
            <option value="html">.html (Web)</option>
            <option value="md">.md (Markdown)</option>
            <option value="js">.js (JavaScript)</option>
        </select>
        <button py-click="download_file">Descargar Archivo</button>
        
        <button py-click="custom_function_1" style="border-color: #ff9800;">Mi Función A</button>
        <button py-click="custom_function_2" style="border-color: #4caf50;">Mi Función B</button>
    </div>

    <div id="editor-container">
        <textarea id="code-editor" spellcheck="false" placeholder="Escribe tu código aquí..."></textarea>
    </div>

    <div class="status-bar">
        <span id="char-count">Caracteres: 0</span>
        <span>Python 3.x (PyScript) Powered</span>
    </div>

    <script type="py">
        from pyscript import document
        from js import Blob, URL, document as js_document

        # --- MEJORA DE TECLADO (TABULACIÓN) ---
        def handle_keydown(event):
            # Si se presiona TAB
            if event.key == "Tab":
                event.preventDefault()
                textarea = event.target
                start = textarea.selectionStart
                end = textarea.selectionEnd

                # Insertar 4 espacios (mejor alineación que el \t por defecto)
                textarea.setRangeText("    ", start, end, "end")
            
            update_status()

        # Registrar el evento de teclado
        editor_element = document.querySelector("#code-editor")
        editor_element.onkeydown = handle_keydown

        def update_status():
            content = document.querySelector("#code-editor").value
            document.querySelector("#char-count").innerText = f"Caracteres: {len(content)}"

        # --- LÓGICA DE DESCARGA ---
        def download_file(event):
            content = document.querySelector("#code-editor").value
            filename = document.querySelector("#filename").value or "archivo"
            extension = document.querySelector("#format-select").value
            
            full_name = f"{filename}.{extension}"
            
            # Crear un blob para la descarga
            blob = Blob.new([content], {type: "text/plain"})
            url = URL.createObjectURL(blob)
            
            # Crear link temporal para descargar
            link = js_document.createElement("a")
            link.href = url
            link.download = full_name
            link.click()
            URL.revokeObjectURL(url)

        # --- ZONA PARA TUS PROPIAS FUNCIONALIDADES ---
        
        def custom_function_1(event):
            """
            Aquí puedes agregar lo que quieras. 
            Ejemplo: Convertir todo el texto a MAYÚSCULAS.
            """
            editor = document.querySelector("#code-editor")
            editor.value = editor.value.upper()
            print("Funcionalidad A ejecutada: Texto en mayúsculas")

        def custom_function_2(event):
            """
            Ejemplo: Limpiar el editor.
            """
            if confirm("¿Seguro que quieres borrar todo?"):
                document.querySelector("#code-editor").value = ""
    </script>

</body>
</html>